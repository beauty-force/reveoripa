import{H as v,L as k,a8 as n,j as N,r as i,o as l,c,a as d,w as p,F as f,b as t,h as U,n as _,t as h,e as L,f as A}from"./app.859a491c.js";import{A as P}from"./UserLayout.45e9cf6c.js";import{u as R}from"./useConfirm.341a7c72.js";import{_ as T}from"./Loading.0df413bb.js";import{_ as E}from"./_plugin-vue_export-helper.cdc0426e.js";import{r as j}from"./ArrowLeftIcon.63dce49d.js";import"./index.e2047365.js";const{confirm:B,alert:D}=R(),H={components:{Head:v,AdminLayout:P,Link:k,ArrowLeftIcon:j,Loading:T},props:{registeredCards:Array,point:Object,code:String},data(){return{selectedCard:null,isNewCard:!1,loading:!1,cardPaymentUrl:"user.point.card_payment_post",registerCardUrl:"user.point.card_register",paymentRegisterUrl:"user.point.paymentRegister",deleteCardUrl:"user.point.deleteCard",purchaseSuccessUrl:"purchase_success",cards:this.registeredCards}},methods:{selectRegisteredCard(e){this.selectedCard=e.id,this.isNewCard=!1},newCardPayment(){this.selectedCard=null,this.isNewCard=!0},registerNewCard(){this.loading=!0,this.selectedCard=null,this.isNewCard=!1,n.get(route(this.registerCardUrl,{type:"purchase"})).then(e=>{e.data.status==1?window.location.href=e.data.link_url:this.loading=!1})},proceedToPayment(){this.loading=!0,this.selectedCard?n.post(route(this.cardPaymentUrl),{card_id:this.selectedCard,id:this.point.id,code:this.code}).then(e=>{e.data.status=="CAPTURED"?window.location.href=this.purchaseSuccessUrl:e.data.status=="AUTHENTICATED"&&(window.location.href=e.data.acs_url)}).finally(()=>{this.loading=!1}):this.isNewCard&&n.post(route(this.paymentRegisterUrl),{id:this.point.id,pay_type:"Card",code:this.code}).then(e=>{e.data.status==0?(D(e.data.message),this.loading=!1):window.location.href=e.data.link_url})},deleteCard(e){B("\u3053\u306E\u30AB\u30FC\u30C9\u3092\u524A\u9664\u3057\u3066\u3082\u3088\u308D\u3057\u3044\u3067\u3059\u304B\uFF1F","","error").then(a=>{a&&(this.loading=!0,n.post(route(this.deleteCardUrl),{card_id:e}).then(u=>{u.data.status==1&&(this.cards=this.cards.filter(m=>m.id!=e))}).finally(()=>{this.loading=!1}))})},getCardBrandIcon(e){return`/images/credit_cards/${e.toLowerCase()}.svg`},formatCardNumber(e){return e.replace(/(.{4})/g,"$1 ").trim()},formatExpireDate(e){return`${e.slice(0,2)}/${e.slice(2)}`}},mounted(){var e;((e=N().props.value.auth.user)==null?void 0:e.type)==1&&(this.cardPaymentUrl="test.user.point.card_payment_post",this.registerCardUrl="test.user.point.card_register",this.paymentRegisterUrl="test.user.point.paymentRegister",this.deleteCardUrl="test.user.point.deleteCard",this.purchaseSuccessUrl="test.purchase_success")}},I={class:"h-full bg-gradient-to-br from-slate-50 via-slate-50 to-slate-50 py-6"},S={class:"max-w-md mx-auto px-4"},V={class:"flex justify-start pb-6"},F=t("span",{class:"text-sm font-medium"},"\u623B\u308B",-1),z={class:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-6 border border-rose-100/50"},M=t("h2",{class:"text-center text-2xl font-bold text-neutral-800 mb-8"}," \u30AB\u30FC\u30C9\u6C7A\u6E08 ",-1),O={key:0,class:"mb-8"},q=t("h3",{class:"text-lg font-bold mb-4 text-neutral-700"},"\u767B\u9332\u6E08\u307F\u30AB\u30FC\u30C9",-1),G=["onClick"],J={class:"flex items-center gap-4"},K=["src","alt"],Q={class:"text-sm font-semibold text-neutral-800"},W={class:"text-xs text-neutral-500"},X={class:"text-xs text-neutral-500"},Y=["onClick"],Z={class:"mb-8"},$=t("h3",{class:"text-lg font-bold mb-4 text-neutral-700"},"\u4ED6\u306E\u30AB\u30FC\u30C9\u3067\u304A\u652F\u6255\u3044",-1),ee=["disabled"],te={class:"mt-6"};function se(e,a,u,m,r,o){const g=i("Head"),C=i("ArrowLeftIcon"),b=i("Link"),w=i("Loading"),x=i("AdminLayout");return l(),c(f,null,[d(g,{title:"\u30AB\u30FC\u30C9\u6C7A\u6E08"}),d(x,null,{default:p(()=>[t("div",I,[t("div",S,[t("div",V,[d(b,{href:e.route("user.point.purchase",u.point.id),class:"flex items-center gap-2 text-rose-600 hover:text-rose-700 transition-colors"},{default:p(()=>[d(C,{class:"w-5 h-5"}),F]),_:1},8,["href"])]),t("div",z,[M,!r.loading&&r.cards.length?(l(),c("div",O,[q,(l(!0),c(f,null,U(r.cards,(s,re)=>(l(),c("div",{key:s.id,class:"mb-4"},[t("div",{onClick:y=>o.selectRegisteredCard(s),class:_([{"border-2 border-rose-500 bg-rose-50 shadow-md":r.selectedCard===s.id,"border border-neutral-200 hover:border-rose-300 hover:shadow-sm":r.selectedCard!==s.id},"w-full p-4 bg-white rounded-xl flex justify-between items-center transition-all duration-200 cursor-pointer"])},[t("div",J,[t("img",{src:o.getCardBrandIcon(s.brand),alt:s.brand,class:"w-16"},null,8,K),t("div",null,[t("p",Q,h(o.formatCardNumber(s.card_no)),1),t("p",W," \u6709\u52B9\u671F\u9650: "+h(o.formatExpireDate(s.expire)),1),t("p",X," \u540D\u7FA9\u4EBA: "+h(s.holder_name),1)])]),t("button",{onClick:L(y=>o.deleteCard(s.id),["stop"]),class:"text-red-500 hover:text-red-700 text-sm font-semibold transition-colors"}," \u524A\u9664 ",8,Y)],10,G)]))),128))])):A("",!0),t("div",Z,[$,t("button",{onClick:a[0]||(a[0]=(...s)=>o.newCardPayment&&o.newCardPayment(...s)),class:_([{"border-2 border-rose-500 bg-rose-50 shadow-md":r.isNewCard,"border border-neutral-200 hover:border-rose-300 hover:shadow-sm":!r.isNewCard},"w-full p-4 bg-white rounded-xl flex justify-center items-center transition-all duration-200"])}," \u30AB\u30FC\u30C9\u60C5\u5831\u3092\u5165\u529B ",2)]),t("button",{type:"submit",disabled:!r.selectedCard&&!r.isNewCard||r.loading,onClick:a[1]||(a[1]=(...s)=>o.proceedToPayment&&o.proceedToPayment(...s)),class:"w-full py-3 bg-gradient-to-r from-rose-500 to-pink-500 text-white rounded-xl text-lg font-semibold transition-all duration-200 hover:from-rose-600 hover:to-pink-600 hover:shadow-lg my-6 disabled:opacity-50 disabled:cursor-not-allowed"}," \u652F\u6255\u3044\u3092\u7D9A\u3051\u308B ",8,ee),t("div",te,[t("a",{onClick:a[2]||(a[2]=(...s)=>o.registerNewCard&&o.registerNewCard(...s)),class:"block w-full text-center text-rose-600 hover:text-rose-700 text-lg font-semibold transition-colors cursor-pointer underline"}," \u65B0\u3057\u3044\u30AB\u30FC\u30C9\u3092\u767B\u9332 ")])])]),d(w,{show:r.loading,message:"\u51E6\u7406\u4E2D..."},null,8,["show"])])]),_:1})],64)}const ue=E(H,[["render",se]]);export{ue as default};
