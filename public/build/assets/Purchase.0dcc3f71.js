import{H as L,L as I,a8 as M,j as N,r as x,o as s,c as i,a as k,w as j,F as T,b as o,f as d,t as A,g as E,a3 as R,l as O,e as B,h as z,n as D,K as V,M as G}from"./app.de8b16eb.js";import{A as J}from"./UserLayout.e1ee1322.js";import{u as H}from"./useConfirm.ca1f33cd.js";import{_ as U}from"./Loading.33f238a0.js";import{_ as Y}from"./_plugin-vue_export-helper.cdc0426e.js";import{r as K}from"./ArrowLeftIcon.600e0b7d.js";import"./index.2d57b3dc.js";const q=3,F="merchant.com.reve-oripa",W="apple-pay-button",X=route("apple_pay_validate"),{confirm:Je,alert:h}=H(),Z={components:{Head:L,AdminLayout:J,Link:I,ArrowLeftIcon:K,Loading:U},props:{errors:Object,auth:Object,point:Object,is_admin:Number,amount:Number,amount_str:String,supported_pay_type:Object,rank:Object,code:String,no_applepay_support:String,no_applepay_setting:String},data(){return{selectedMethod:null,agreeTerms:!1,loading:!1,card_payment_uri:"user.point.card_payment",payment_stage:"register",pay_type_titles:{Card:"\u30AF\u30EC\u30B8\u30C3\u30C8\u30AB\u30FC\u30C9",Paypay:"PayPay",Konbini:"\u30B3\u30F3\u30D3\u30CB\u6255\u3044",Virtualaccount:"\u9280\u884C\u632F\u8FBC",Applepay:"Apple Pay",amazonpay:"Amazon Pay",Googlepay:"Google Pay"}}},methods:{selectPaymentMethod(e){this.selectedMethod=e},handleSubmit(){if(!this.selectedMethod){h("\u652F\u6255\u3044\u65B9\u6CD5\u3092\u9078\u629E\u3057\u3066\u304F\u3060\u3055\u3044");return}if(!this.agreeTerms){h("\u500B\u4EBA\u60C5\u5831\u306E\u53D6\u308A\u6271\u3044\u306B\u540C\u610F\u3059\u308B\u5FC5\u8981\u304C\u3042\u308A\u307E\u3059");return}if(!this.supported_pay_type.includes(this.selectedMethod)){h("\u3053\u306E\u652F\u6255\u3044\u65B9\u6CD5\u306F\u8FD1\u3005\u5B9F\u88C5\u3055\u308C\u308B\u4E88\u5B9A\u3067\u3059\u3002");return}if(this.selectedMethod=="Applepay"&&!window.ApplePaySession){h(this.no_applepay_support,"","error");return}this.paymentRegister(this.selectedMethod)},submit(){},format_number(e){return String(e).replace(/(.)(?=(\d{3})+$)/g,"$1,")},paymentRegister(e){if(this.loading=!0,e=="Card"){window.location.href=route(this.card_payment_uri,{id:this.point.id,code:this.code});return}M.post(this.is_admin==1?route("test.user.point.paymentRegister"):route("user.point.paymentRegister"),{id:this.point.id,pay_type:e,code:this.code}).then(a=>{a.data.status==0?(h(a.data.message),this.loading=!1):e=="Card"||e=="Paypay"||e=="Konbini"||e=="Virtualaccount"?a.data.status&&(window.location.href=a.data.link_url):e=="Applepay"&&(this.payment_stage="Applepay",this.$nextTick(()=>{const r=document.getElementById("applepay_container");if(r.innerHTML="",window.ApplePaySession)ApplePaySession.canMakePaymentsWithActiveCard(F).then(n=>{if(n){const c=document.createElement("button");c.setAttribute("id",W),c.setAttribute("lang","ja-JP");const P="buy",w="#d68d2f";c.setAttribute("style",`-webkit-appearance: -apple-pay-button;
                                                -apple-pay-button-type: ${P};
                                                -apple-pay-button-style: ${w};
                                                width: 220px;
                                                height: 48px;
                                                text-align: center;
                                                font-size: 18px;
                                                border-radius: 5px;
                                                `),r.appendChild(c),c.addEventListener("click",v=>{const y={countryCode:"JP",currencyCode:"JPY",supportedNetworks:["visa","masterCard","jcb","amex"],merchantCapabilities:["supports3DS"],total:{label:a.data.response.label,amount:a.data.response.amount}},t=new ApplePaySession(q,y);t.onvalidatemerchant=p=>{const f=p.validationURL;fetch(X,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({validationURL:f})}).then(u=>u.json()).then(u=>{t.completeMerchantValidation(u)})},t.oncancel=p=>{},t.onpaymentauthorized=p=>{const f=p.payment.token;t.completePayment(ApplePaySession.STATUS_SUCCESS);const u=btoa(JSON.stringify(f.paymentData));M.post(this.is_admin==1?route("test.user.point.paymentExecute"):route("user.point.paymentExecute"),{pay_type:e,order_id:a.data.response.id,access_id:a.data.response.access_id,token:u}).then(g=>{g.data.status==0?h(g.data.message):window.location.href=g.data.redirect_uri})},t.begin()})}else r.innerHTML=this.no_applepay_setting});else if(e=="Googlepay"){const l=document.createElement("script");l.src="https://pay.google.com/gp/p/js/pay.js",l.onload=this.renderGooglePayButton.bind(this,a.data.response),document.head.appendChild(l)}else if(e=="amazonpay"){this.payment_stage="amazonpay";const l=document.createElement("script");l.src="https://static-fe.payments-amazon.com/checkout.js",l.onload=this.renderAmazonPayButton.bind(this,a.data.response),document.head.appendChild(l)}}),this.loading=!1)})},renderAmazonPayButton(e){this.loading=!1,amazon.Pay.renderButton("#amazonpay_container",{merchantId:e.merchant_id,publicKeyId:e.public_key_id,ledgerCurrency:"JPY",checkoutLanguage:"ja_JP",productType:"PayOnly",placement:"Checkout",buttonColor:"Gold",buttonWidth:"300px",buttonHeight:"50px",createCheckoutSessionConfig:{payloadJSON:JSON.stringify(e.payload),signature:e.signature,algorithm:"AMZN-PAY-RSASSA-PSS-V2"}})},renderGooglePayButton(e){this.loading=!1,this.payment_stage="Googlepay";const a=new google.payments.api.PaymentsClient({environment:e.google_pay_environment}),r={apiVersion:2,apiVersionMinor:0},l={type:"PAYMENT_GATEWAY",parameters:{gateway:"fincode",gatewayMerchantId:e.shop_id}},n={merchantId:e.google_pay_merchant_id,merchantName:e.google_pay_merchant_name},c=m=>({currencyCode:"JPY",totalPrice:m,totalPriceStatus:"FINAL"}),y={type:"CARD",parameters:{allowedAuthMethods:["PAN_ONLY"],allowedCardNetworks:["VISA","MASTERCARD","JCB","AMEX","DISCOVER"],billingAddressParameters:{format:"FULL",phoneNumberRequired:!0}}},t=Object.assign({tokenizationSpecification:l},y),p=Object.assign({},r);p.allowedPaymentMethods=[t],p.transactionInfo=c(e.amount),p.merchantInfo=n;const f=(m,b)=>{const C=a.createButton({onClick:b,buttonColor:"default",buttonType:"long"});m.appendChild(C)},u=async()=>{try{const b=(await a.loadPaymentData(p)).paymentMethodData.tokenizationData.token,C=btoa(b);this.loading=!0,M.post(this.is_admin==1?route("test.user.point.paymentExecute"):route("user.point.paymentExecute"),{pay_type:"Googlepay",order_id:e.id,access_id:e.access_id,method:"1",token:C}).then(S=>{S.data.status==0?h(S.data.message):window.location.href=S.data.redirect_uri,this.loading=!1})}catch(m){console.error(m)}},g=Object.assign({},r);g.allowedPaymentMethods=[y],a.isReadyToPay(g).then(m=>{if(m.result){const b=document.getElementById("googlepay_container");b.innerHTML="",f(b,u)}}).catch(m=>{console.error(m)})}},mounted(){var e;((e=N().props.value.auth.user)==null?void 0:e.type)==1&&(this.card_payment_uri="test.user.point.card_payment")}},_=e=>(V("data-v-0127eaaf"),e=e(),G(),e),Q={class:"h-full bg-gradient-to-br from-slate-50 via-slate-50 to-slate-50 pb-8"},$={class:"max-w-md mx-auto px-4"},ee={class:"flex justify-start mb-6"},te=_(()=>o("span",{class:"text-sm font-medium"},"\u623B\u308B",-1)),oe={class:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-6 border border-rose-100/50"},ae={key:0},ne={class:"text-center mb-8"},se={class:"text-2xl font-bold text-neutral-800 mb-2"},ie={key:0,class:"inline-block bg-rose-50 text-rose-600 px-4 py-1.5 rounded-full text-sm font-medium"},re={class:"bg-gradient-to-r from-rose-500 to-pink-500 p-4 rounded-xl text-center mb-8"},ce={class:"text-white text-3xl font-bold"},de={class:"text-center text-neutral-600 mb-8"},le={class:"flex items-center justify-center gap-2 text-sm"},pe={class:"mt-1"},me=["href"],ue={class:"space-y-3 mb-6"},he=["onClick"],_e={class:"font-medium text-neutral-700"},ye={key:0,class:"grid grid-cols-3 grid-rows-2 gap-1 w-24 h-10"},ge=_(()=>o("img",{src:"/images/credit_cards/visa.svg",alt:"Visa"},null,-1)),be=_(()=>o("img",{src:"/images/credit_cards/master.svg",alt:"Mastercard"},null,-1)),fe=_(()=>o("img",{src:"/images/credit_cards/jcb.svg",alt:"JCB"},null,-1)),Pe=_(()=>o("img",{src:"/images/credit_cards/amex.svg",alt:"American Express"},null,-1)),we=_(()=>o("img",{src:"/images/credit_cards/diners.svg",alt:"Diners Club"},null,-1)),xe=_(()=>o("img",{src:"/images/credit_cards/discover.svg",alt:"Discover"},null,-1)),ke=[ge,be,fe,Pe,we,xe],Ae={key:1,src:"/images/payments/amazon-pay.png",alt:"Amazon Pay",class:"w-24 h-10 object-contain"},ve={key:2,src:"/images/payments/apple-pay.png",alt:"Apple Pay",class:"w-24 h-10 object-contain"},Ce={key:3,src:"/images/payments/paypay.png",alt:"PayPay",class:"w-24 h-10 object-contain"},Se={key:4,src:"/images/payments/konbini1.png",alt:"Konbini",class:"w-24 h-10 object-contain"},Me={key:5,src:"/images/payments/bank.png",alt:"Bank Transfer",class:"w-24 h-10 object-contain"},Te={key:6,src:"/images/payments/google-pay.svg",alt:"Google Pay",class:"w-24 h-10 object-contain"},Le=["disabled"],Ie={key:1,class:"text-center",id:"applepay_container"},Ne={key:2,class:"text-center",id:"amazonpay_container"},je={key:3,class:"text-center",id:"googlepay_container"};function Ee(e,a,r,l,n,c){const P=x("Head"),w=x("ArrowLeftIcon"),v=x("Loading"),y=x("AdminLayout");return s(),i(T,null,[k(P,{title:"\u6C7A\u6E08\u767B\u9332"}),k(y,null,{default:j(()=>[o("div",Q,[o("div",$,[o("div",ee,[n.payment_stage!="register"?(s(),i("button",{key:0,onClick:a[0]||(a[0]=t=>n.payment_stage="register"),class:"flex items-center gap-2 text-rose-600 hover:text-rose-700 transition-colors"},[k(w,{class:"w-5 h-5"}),te])):d("",!0)]),o("div",oe,[n.payment_stage=="register"?(s(),i("div",ae,[o("div",ne,[o("h2",se,A(c.format_number(r.point.point))+" \u30DD\u30A4\u30F3\u30C8 ",1),r.rank&&r.rank.pt_rate>0?(s(),i("span",ie," + "+A(c.format_number(r.point.point*r.rank.pt_rate/100))+" \u30DC\u30FC\u30CA\u30B9 ",1)):d("",!0)]),o("div",re,[o("div",ce," \xA5 "+A(r.amount.toLocaleString()),1)]),o("div",de,[o("label",le,[E(o("input",{type:"checkbox","onUpdate:modelValue":a[1]||(a[1]=t=>n.agreeTerms=t),class:"w-4 h-4 text-slate-500 border-slate-300 rounded focus:ring-slate-500"},null,512),[[R,n.agreeTerms]]),O(" \u500B\u4EBA\u60C5\u5831\u306E\u53D6\u308A\u6271\u3044\u306B\u540C\u610F\u3059\u308B ")]),o("div",pe,[o("a",{href:e.route("main.privacy_police"),class:"text-rose-500 hover:text-rose-600 text-sm underline"}," \u53D6\u308A\u6271\u3044\u306E\u8A73\u7D30\u3092\u78BA\u8A8D\u3059\u308B ",8,me)])]),o("form",{onSubmit:a[2]||(a[2]=B((...t)=>c.handleSubmit&&c.handleSubmit(...t),["prevent"]))},[o("div",ue,[(s(!0),i(T,null,z(r.supported_pay_type,t=>(s(),i("button",{key:t,type:"button",onClick:p=>c.selectPaymentMethod(t),class:D(["w-full px-4 py-3 rounded-xl flex justify-between items-center transition-all duration-200",n.selectedMethod===t?"border-2 border-rose-500 bg-rose-50 shadow-md":"border border-neutral-200 hover:border-rose-300 hover:shadow-sm"])},[o("span",_e,A(n.pay_type_titles[t]),1),t==="Card"?(s(),i("div",ye,ke)):d("",!0),t==="amazonpay"?(s(),i("img",Ae)):d("",!0),t==="Applepay"?(s(),i("img",ve)):d("",!0),t==="Paypay"?(s(),i("img",Ce)):d("",!0),t==="Konbini"?(s(),i("img",Se)):d("",!0),t==="Virtualaccount"?(s(),i("img",Me)):d("",!0),t==="Googlepay"?(s(),i("img",Te)):d("",!0)],10,he))),128))]),o("button",{type:"submit",disabled:n.selectedMethod==null,class:"w-full py-3 bg-gradient-to-r from-rose-500 to-pink-500 text-white rounded-xl text-lg font-semibold transition-all duration-200 hover:from-rose-600 hover:to-pink-600 hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed"}," \u652F\u6255\u3044\u3092\u7D9A\u3051\u308B ",8,Le)],32)])):d("",!0),n.payment_stage=="Applepay"?(s(),i("div",Ie)):d("",!0),n.payment_stage=="amazonpay"?(s(),i("div",Ne)):d("",!0),n.payment_stage=="Googlepay"?(s(),i("div",je)):d("",!0)])]),k(v,{show:n.loading,message:"\u6C7A\u6E08\u767B\u9332\u4E2D..."},null,8,["show"])])]),_:1})],64)}const He=Y(Z,[["render",Ee],["__scopeId","data-v-0127eaaf"]]);export{He as default};
